#!/usr/bin/bash
set -e
repo_name="$1"

if [[ -z "$repo_name" ]]; then
    echo "Usage: $0 <repository-name>"
    exit 1
fi

case "$1" in
	*.git) ;;
	*)
		repo_name="$1.git"
		;;
esac

repo_path="/home/git/$repo_name"

if [[ -d "$repo_path" ]]; then
    echo "Error: repository '$repo_name' already exists at $repo_path"
    exit 1
fi

mkdir -p "$repo_path"
git init --bare "$repo_path"

chown -R git:www-data "$repo_path"
find "$repo_path" -type d -exec chmod 2750 {} \;
find "$repo_path" -type f -exec chmod 640 {} \;
chmod g+s "$repo_path"

echo "Repository '$repo_name' created at $repo_path"

